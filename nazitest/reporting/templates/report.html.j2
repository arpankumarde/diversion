<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>NAZITEST Report â€” {{ metadata.target_url }}</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, sans-serif; max-width: 960px; margin: 40px auto; padding: 0 20px; color: #222; line-height: 1.6; }
        h1 { border-bottom: 3px solid #333; padding-bottom: 10px; }
        h2 { border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 30px; }
        table { border-collapse: collapse; width: 100%; margin: 15px 0; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #333; color: white; }
        tr:nth-child(even) { background: #f9f9f9; }
        .badge { display: inline-block; padding: 2px 10px; border-radius: 4px; color: white; font-weight: bold; font-size: 0.85em; }
        .critical { background: #d32f2f; }
        .high { background: #f57c00; }
        .medium { background: #fbc02d; color: #333; }
        .low { background: #388e3c; }
        .info { background: #1976d2; }
        .stats { display: flex; gap: 20px; flex-wrap: wrap; }
        .stat-card { background: #f5f5f5; padding: 15px 25px; border-radius: 8px; text-align: center; min-width: 120px; }
        .stat-card .number { font-size: 2em; font-weight: bold; }
        .stat-card .label { color: #666; font-size: 0.9em; }
        pre { background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 6px; overflow-x: auto; font-size: 0.9em; }
        .vuln-card { border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin: 15px 0; }
        .vuln-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ccc; color: #999; font-size: 0.85em; }
    </style>
</head>
<body>
    <h1>NAZITEST Security Report</h1>

    <table>
        <tr><th>Target</th><td>{{ metadata.target_url }}</td></tr>
        <tr><th>Run ID</th><td>{{ metadata.run_id }}</td></tr>
        <tr><th>Generated</th><td>{{ metadata.generated_at }}</td></tr>
        <tr><th>Tool</th><td>{{ metadata.tool }} v{{ metadata.version }}</td></tr>
    </table>

    <h2>Executive Summary</h2>
    <div class="stats">
        <div class="stat-card">
            <div class="number">{{ summary.total_hypotheses }}</div>
            <div class="label">Findings</div>
        </div>
        <div class="stat-card">
            <div class="number" style="color:#d32f2f">{{ summary.critical }}</div>
            <div class="label">Critical</div>
        </div>
        <div class="stat-card">
            <div class="number" style="color:#f57c00">{{ summary.high }}</div>
            <div class="label">High</div>
        </div>
        <div class="stat-card">
            <div class="number" style="color:#fbc02d">{{ summary.medium }}</div>
            <div class="label">Medium</div>
        </div>
        <div class="stat-card">
            <div class="number" style="color:#388e3c">{{ summary.low }}</div>
            <div class="label">Low</div>
        </div>
        <div class="stat-card">
            <div class="number">{{ graph_stats.nodes }}</div>
            <div class="label">Graph Nodes</div>
        </div>
    </div>

    <h2>Vulnerability Findings</h2>
    {% if vulnerabilities %}
    {% for vuln in vulnerabilities %}
    <div class="vuln-card">
        <div class="vuln-header">
            <h3>{{ vuln.title }}</h3>
            <span class="badge {{ vuln.severity }}">{{ vuln.severity | upper }}</span>
        </div>
        <p>{{ vuln.description }}</p>
        <table>
            {% if vuln.vuln_type %}<tr><th>Type</th><td>{{ vuln.vuln_type }}</td></tr>{% endif %}
            {% if vuln.endpoint %}<tr><th>Endpoint</th><td>{{ vuln.endpoint }}</td></tr>{% endif %}
            {% if vuln.parameter %}<tr><th>Parameter</th><td>{{ vuln.parameter }}</td></tr>{% endif %}
            <tr><th>Confidence</th><td>{{ "%.0f" | format(vuln.confidence * 100) }}%</td></tr>
            {% if vuln.owasp_category %}<tr><th>OWASP</th><td>{{ vuln.owasp_category }}</td></tr>{% endif %}
            {% if vuln.cwe_id %}<tr><th>CWE</th><td>{{ vuln.cwe_id }}</td></tr>{% endif %}
            {% if vuln.cvss_score %}<tr><th>CVSS</th><td>{{ vuln.cvss_score }}</td></tr>{% endif %}
        </table>
        {% if vuln.poc_script %}
        <h4>Proof of Concept</h4>
        <pre>{{ vuln.poc_script }}</pre>
        {% endif %}
        {% if vuln.remediation %}
        <h4>Remediation</h4>
        <p>{{ vuln.remediation }}</p>
        {% endif %}
    </div>
    {% endfor %}
    {% else %}
    <p>No findings.</p>
    {% endif %}

    <footer>
        Generated by NAZITEST v{{ metadata.version }} | {{ metadata.generated_at }}
    </footer>
</body>
</html>
